@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.ApplicationConfig
@import view_models.paye.PayeGovernmentSpend

@import utils.HtmlFormatter
@import views.html.main
@import views.html.helpers.BackLinkView
@import scala.concurrent.ExecutionContext

@this(
	main: main,
	backLinkView: BackLinkView,
	htmlFormatter: HtmlFormatter
)

@(	viewModel:PayeGovernmentSpend,
	isWelshTaxPayer: Boolean
	)(
	implicit messages: Messages,
	request: Request[_],
	templateRenderer: uk.gov.hmrc.renderer.TemplateRenderer,
	appConfig: ApplicationConfig,
		ec: ExecutionContext
)

@main(
		title = Messages("paye.ats.treasury_spending.title") + Messages("generic.to_from", viewModel.taxYearFrom, viewModel.taxYearTo)
	) {

	@backLinkView(Messages("generic.back"))


		<h1 class="heading-xlarge flush--bottom">@Html(Messages("paye.ats.treasury_spending.title"))</h1>
		<h2 class="heading-xlarge flush--top">@Html(Messages("paye.generic.tax_year_heading",
			htmlFormatter.toHtmlNonBroken(Messages("generic.tax.year.start") + " " + viewModel.taxYearFrom),
			htmlFormatter.toHtmlNonBroken(Messages("generic.tax.year.end") + " " + viewModel.taxYearTo)))</h2>

		<p id="intro-paragraph">@Messages("paye.ats.treasury_spending.introParagraph")</p>


		<dl id="tax-spent">
			<div id="tax-spent-header" class="heading-medium">
				<dt>@Html(Messages("generic.description"))</dt>
				<dd>@Html(Messages("generic.amount_pounds"))</dd>
			</div>
			@for(rowModel <- viewModel.orderedSpendRows){
				<div>
					<div class="content">
						<dt id="@rowModel.category">@Messages("paye.ats.treasury_spending.table." + rowModel.category)
							<span>&nbsp;(@rowModel.spendData.percentage%)</span>
						</dt>
						<dd>&pound;@rowModel.spendData.amount.toHalfRoundedUpAmount</dd>
					</div>
					<div class="graph-green-bar" style="width: @{rowModel.spendData.percentage}%;" aria-hidden="true"></div>
					<div class="graph-grey-bar" aria-hidden="true"></div>
				</div>
			}
			<div id="tax-spent-footer" class="paye-tax-spent-footer">
				<dt id="gov-spend-total" class="heading-medium">@Messages("paye.ats.treasury_spending.total")</dt>
				<dd>&pound;@viewModel.totalAmount</dd>
			</div>
		</dl>


		@if(isWelshTaxPayer){
			<p id="welsh-tax-payer-paragraph-2">@Messages("paye.ats.treasury_spending.para2")</p>
			<p id="welsh-tax-payer-paragraph-1">@Messages("paye.ats.treasury_spending.welsh.tax.payer.para1")</p>
			<p id="welsh-tax-payer-paragraph-3">@Messages("paye.ats.treasury_spending.welsh.tax.payer.para3")</p>
			<p id="welsh-tax-payer-paragraph-4">@Messages("paye.ats.treasury_spending.welsh.tax.payer.para4") <a href="@appConfig.calculateWelshIncomeTaxSpend" target="blank" rel="noopener noreferrer">@appConfig.calculateWelshIncomeTaxSpend</a></p>
		} else {
			<p id="paragraph-2">@Messages("paye.ats.treasury_spending.para2")</p>
			<p id="paragraph-1">@Messages("paye.ats.treasury_spending.para1")</p>
			@if(viewModel.isScottish) {
				<p id="scottish-spending-link">@Messages("paye.ats.treasury_spending.scottish.spending.1")
					<a href="@appConfig.scottishIncomeTaxLink(viewModel.taxYear)" target="blank" rel="noopener noreferrer">@Messages("paye.ats.treasury_spending.scottish.spending.2")</a>
					@Messages("paye.ats.treasury_spending.scottish.spending.3")
				</p>
			}
			<p id="paragraph-3">@Messages("paye.ats.treasury_spending.para3")</p>
			<p id="paragraph-4">@Messages("paye.ats.treasury_spending.para4")</p>
		}
}
